# =============================================================================
# PostgreSQL Client Authentication Configuration
# =============================================================================

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections (Unix socket)
local   all             postgres                                peer
local   all             all                                     peer

# Replication connections (for standby)
host    replication     replicator      172.16.91.101/32        scram-sha-256
host    replication     replicator      172.16.91.102/32        scram-sha-256

# Kamailio connections - MD5 cho performance (hàng trăm queries/giây)
# Only allow from local node (applications connect to LOCAL PostgreSQL)
host    kamailio        kamailio        127.0.0.1/32            md5
host    kamailio        kamailio        172.16.91.101/32        md5
host    kamailio        kamailio        172.16.91.102/32        md5

# VoIP Admin - SCRAM-SHA-256 (Go driver hỗ trợ tốt, ít connection)
# Only allow from local node (applications connect to LOCAL PostgreSQL)
host    voip            voipadmin       127.0.0.1/32            scram-sha-256
host    voip            voipadmin       172.16.91.101/32        scram-sha-256
host    voip            voipadmin       172.16.91.102/32        scram-sha-256

# FreeSWITCH ODBC - MD5 cho tương thích (psqlODBC driver issue với SCRAM)
# Only allow from local node (applications connect to LOCAL PostgreSQL)
host    voip            freeswitch      127.0.0.1/32            md5
host    voip            freeswitch      172.16.91.101/32        md5
host    voip            freeswitch      172.16.91.102/32        md5

# Localhost (for monitoring, admin)
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# Reject all other connections
host    all             all             0.0.0.0/0               reject
